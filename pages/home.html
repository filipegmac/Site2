<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/styles/home.css">
    <title>Home</title>
</head>
<body>

<div class="home">
    <h1 id="bemvindo">Seja bem-vindo, </h1>
    <p id="email"></p>
    <div class="container">
        <h3>Anime Favorito</h3>
        <div id="anime-container">
            <img id="anime-image" src="" alt="Anime Favorito" onerror="this.src='/img/default.webp'">
            <p id="anime-title"></p>
        </div>
    </div>
    <button id="sair" onclick="logout()">Sair</button>
</div>

<script>
    async function loadUserData() {
        const token = localStorage.getItem('token');

        if (!token) {
            alert('Você não está logado!');
            window.location.href = 'login.html';
            return;
        }

        try {
            const response = await fetch('https://projetoweb-api.vercel.app/user', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const userData = await response.json();
                const { name, email, animes } = userData;

                document.getElementById('bemvindo').textContent += `${name}!`;
                document.getElementById('email').textContent = `Seu e-mail é: ${email}`;

                if (animes && animes.length > 0) {
                    const anime = animes[0];
                    document.getElementById('anime-image').src = anime.cover || '/img/default.webp';
                    document.getElementById('anime-title').textContent = anime.title || 'Título não disponível';
                } else {
                    document.getElementById('anime-title').textContent = 'Você ainda não escolheu um anime favorito.';
                }
            } else {
                alert('Erro ao carregar os dados do usuário. Faça login novamente.');
                logout();
            }
        } catch (error) {
            console.error('Erro ao carregar os dados do usuário:', error);
            alert('Erro ao conectar com o servidor. Tente novamente mais tarde.');
            logout();
        }
    }

    function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('usuario');
        window.location.href = 'login.html';
    }

    loadUserData();
</script>

</body>
</html>
